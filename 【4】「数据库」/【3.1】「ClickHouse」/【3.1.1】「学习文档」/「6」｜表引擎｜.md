

## 一、Log系列引擎

![截屏2021-11-08 下午11.22.13](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.22.13.png)

### 1. TinyLog

![截屏2021-11-08 下午11.25.29](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.25.29.png)

![截屏2021-11-08 下午11.26.42](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.26.42.png)

![截屏2021-11-08 下午11.28.30](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.28.30.png)

### 2.Log

![截屏2021-11-08 下午11.30.23](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.30.23.png)

![截屏2021-11-08 下午11.31.38](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.31.38.png)

![截屏2021-11-08 下午11.32.07](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.32.07.png)

### 3. StripeLog

![截屏2021-11-08 下午11.33.13](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.33.13.png)

![截屏2021-11-08 下午11.33.23](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.33.23.png)

![截屏2021-11-08 下午11.33.33](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.33.33.png)

## 二、MergeTree

![截屏2021-11-08 下午11.37.02](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.37.02.png)

![截屏2021-11-08 下午11.37.56](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.37.56.png)

### 1）MergeTree

<font color='red'>主键不负责去重，主键负责帮助索引</font>

![截屏2021-11-08 下午7.33.54](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午7.33.54.png)

```
## 索引力度
SETTING index_granularity = 8192;

## 分区规则
如果是按照数字，则是数字
如果是String，则是hash
```

**--底层存储**

![截屏2021-11-08 下午11.41.23](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.41.23.png)

```
optimize table ----- final;
```

![截屏2021-11-08 下午11.47.58](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.47.58.png)

![截屏2021-11-08 下午11.53.12](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.53.12.png)

![截屏2021-11-08 下午11.54.09](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.54.09.png)

![截屏2021-11-08 下午11.57.14](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.57.14.png)

![截屏2021-11-08 下午11.58.27](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.58.27.png)

**-- 其他参数**

![截屏2021-11-08 下午11.49.44](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.49.44.png)

![截屏2021-11-08 下午11.50.04](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.50.04.png)

![截屏2021-11-08 下午11.50.39](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-08 下午11.50.39.png)

### 2）ReplacingMergeTree

![截屏2021-11-09 上午12.05.56](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.11.30.png)

```
## 使用多线程插入的时候，新老数据进行折叠合并，删除的时候，删了新的留下了老的
（除了主键以外可能会发生变化的字段）

## 一个数据块最大是8192行，数据同一时间插入会被放到同一数据块中，触发合并，会按照分区将多个数据块进行合并
```

![截屏2021-11-09 上午12.21.30](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.21.30.png)

### 3） CollapsingMergeTree

![截屏2021-11-09 上午12.25.44](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.25.44.png)

![截屏2021-11-09 上午12.29.50](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.29.50.png)

![截屏2021-11-09 上午12.34.11](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.34.11.png)

![截屏2021-11-09 上午12.34.31](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.34.31.png) 

### 4）VersionedCollapsingMergeTree

![截屏2021-11-09 上午12.36.29](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.36.29.png)

![截屏2021-11-09 上午12.38.02](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.38.02.png)

![截屏2021-11-09 上午12.38.29](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.38.29.png)



### 5）SummingMergeTree

![截屏2021-11-09 上午12.39.08](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.39.08.png)

![截屏2021-11-09 上午12.39.39](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.39.39.png)

![截屏2021-11-09 上午12.40.03](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.40.03.png)

![截屏2021-11-09 上午12.40.21](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.40.21.png)

![截屏2021-11-09 上午12.41.56](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.41.56.png)

![截屏2021-11-09 上午12.42.30](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.42.30.png)

![截屏2021-11-09 上午12.42.54](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.42.54.png)

![截屏2021-11-09 上午12.43.08](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.43.08.png)

### 6）AggregatingMergeTree

![截屏2021-11-09 上午12.43.46](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.43.46.png)

![截屏2021-11-09 上午12.43.58](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.43.58.png) ![截屏2021-11-09 上午12.50.05](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.50.05.png)

![截屏2021-11-09 上午12.51.40](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.51.40.png)

![截屏2021-11-09 上午12.51.55](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.51.55.png)

![截屏2021-11-09 上午12.52.13](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.52.13.png)

![截屏2021-11-09 上午12.52.35](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.52.35.png)

![截屏2021-11-09 上午12.55.23](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.55.23.png)

<font color='red'>使用物化视图同步聚合数据</font>

![截屏2021-11-09 上午12.56.38](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.56.38.png)

![截屏2021-11-09 上午12.57.29](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-11-09 上午12.57.29.png)



```
CREATE TABLE test.test_table_10
(
    `remark_1` Nullable(String),
    `remark_2` Nullable(String),
    `remark_3` Nullable(String),
    `hhhh` String
)
ENGINE = MergeTree
ORDER BY hhhh

insert into test.test_table_10 values ('a','b','c','hh'),('a','b','c','hh'),('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
insert into test.test_table_10 values ('a','b','c','hh');
```











