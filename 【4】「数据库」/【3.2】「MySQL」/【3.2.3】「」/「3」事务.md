## 一、什么是事务？

```
一个事务其实就是一个完整的业务逻辑，是一个最小的工作单元。
不可再分。
```

```
完整的业务逻辑：
	1）假设转账，从A账户向B账户中转账10000.
	2）将A账户的钱减去10000（update语句）
	3）将B账户的钱加上10000（update语句）
这就是一个完整的业务逻辑。

以上的操作是一个最小的工作单元，要么同时成功，要么同时失败，不可再分。
这两个update语句要求必须同时成功或者同时失败，这样才能保证钱是正确的。
```

## 二、事务本身

```
1. 只有DML语句才有事务一说，insert、update、delete。
	因为只有以上的三个语句是数据库表中数据进行增、删、改的。
	只要你的操作一旦涉及到数据的增、删、改，那么就一定要考虑安全问题。
	
2. 本质上，一个事务其实就是多条DML语句同时成功，或者同时失败。
```

## 三、事务是如何做到多条DML语句同时成功或失败呢？

```
InnoDB存储引擎：提供一组用来记录事务性活动的日志文件

例：
	事务开启了：
	insert
	insert
	insert
	delete
	update
	update
	事务结束了！
	
在事务的执行过程中，每一条DML的操作都会记录到“事务性活动的日志文件”
```

## 四、提交事务 & 回滚事务

```
**提交事务:**
	清空事务性活动的日志文件，将数据全部彻底持久化道数据库表中。
	提交事务标志着，事务的结束。并且是一种全部成功的结束。
	
	commit;

**回滚事务：**
	将之前所有的DML操作全部撤销，并且清空事务性活动的日志文件。
	回滚事务标志着，事务的结束。并且是一种全部失败的结束。
	
	rollback; -- 回滚永远都是只能回滚道上一次的提交点！
```

```
MySQL默认情况下是支持自动提交事务的。每执行一条DML语句，则提交一次！

这种自动提交实际上是不符合我们的开发习惯，因为一个业务通常是需要多条DML语句共同执行才能完成的，为了保证数据的安全，必须要求同时成功之后再提交，所以不能执行一条就提交一条。
```

```sql
-- 开启事务命令：
start transaction;
```

## 五、事务的特性

```
A：原子性
	说明事务是最小的工作单元，不可再分。
C：一致性
	所有事务要求，在同一个事务当中，所有操作必须同时成功，或者同时失败，以保证数据的一致性。
I：隔离性
	A事务和B事务之间具有一定的隔离。
D：持久性
	事务最终结束的一个保障。事务提交，就相当于将没有保存到硬盘上的数据保存到硬盘上！
```



![截屏2021-12-05 下午2.00.14](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-12-05 下午2.00.14.png)

![截屏2021-12-05 下午2.00.45](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-12-05 下午2.00.45.png)

![截屏2021-12-05 下午2.02.17](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-12-05 下午2.02.17.png)

![截屏2021-12-05 下午2.05.14](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-12-05 下午2.05.14.png)

![截屏2021-12-05 下午2.08.25](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-12-05 下午2.08.25.png)  



![截屏2021-12-05 下午2.10.48](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-12-05 下午2.10.48.png)

  

 ![截屏2021-12-05 下午2.11.06](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-12-05 下午2.11.06.png)





![截屏2021-12-05 下午2.12.38](/Users/peiyang/Library/Application Support/typora-user-images/截屏2021-12-05 下午2.12.38.png)